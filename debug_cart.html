<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f8fafc; }
        .container { max-width: 800px; margin: 0 auto; }
        .debug-section { background: white; padding: 20px; margin: 15px 0; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; margin: 5px; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-success { background: #10b981; color: white; }
        .cart-display { background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 15px 0; font-family: monospace; }
        .error { background: #fee2e2; color: #991b1b; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { background: #d1fae5; color: #065f46; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Cart Debug Test</h1>
        
        <div class="debug-section">
            <h3>üîß Cart Functions Test</h3>
            <button class="btn btn-primary" onclick="testAddToCart()">Test Add to Cart</button>
            <button class="btn btn-primary" onclick="testGetCartTotal()">Test Get Cart Total</button>
            <button class="btn btn-danger" onclick="testClearCart()">Clear Cart</button>
            <button class="btn btn-success" onclick="testSpecialOffer()">Test Special Offer</button>
        </div>
        
        <div class="debug-section">
            <h3>üìä Current Cart Status</h3>
            <div id="cart-status" class="cart-display">
                Loading cart status...
            </div>
        </div>
        
        <div class="debug-section">
            <h3>üîç Debug Information</h3>
            <div id="debug-info" class="cart-display">
                Loading debug info...
            </div>
        </div>
        
        <div class="debug-section">
            <h3>üìù Test Results</h3>
            <div id="test-results"></div>
        </div>
    </div>

    <script>
        // Mock cart functions for testing
        let cart = [];
        
        function addToCart(itemId, itemName, price, quantity = 1) {
            const safePrice = parseFloat(price) || 0;
            const safeQuantity = parseInt(quantity) || 1;
            
            const existingItem = cart.find(item => item.id === itemId);
            
            if (existingItem) {
                existingItem.quantity += safeQuantity;
                existingItem.totalPrice = existingItem.quantity * existingItem.price;
            } else {
                cart.push({
                    id: itemId,
                    name: itemName,
                    price: safePrice,
                    quantity: safeQuantity,
                    totalPrice: safePrice * safeQuantity
                });
            }
            
            updateDisplay();
            addTestResult('‚úÖ Added item to cart', 'success');
        }
        
        function getCartTotal() {
            if (!Array.isArray(cart)) {
                console.warn('Cart is not an array:', cart);
                return 0;
            }
            return cart.reduce((total, item) => {
                const itemPrice = parseFloat(item.totalPrice) || 0;
                return total + itemPrice;
            }, 0);
        }
        
        function clearCart() {
            cart = [];
            updateDisplay();
            addTestResult('üóëÔ∏è Cart cleared', 'success');
        }
        
        function addSpecialOfferToCart(offerId, offerTitle, offerPrice) {
            try {
                if (!offerId || !offerTitle || !offerPrice) {
                    addTestResult('‚ùå Invalid parameters for special offer', 'error');
                    return;
                }
                
                const safePrice = parseFloat(offerPrice) || 0;
                if (safePrice <= 0) {
                    addTestResult('‚ùå Invalid offer price', 'error');
                    return;
                }
                
                addToCart(`offer_${offerId}`, offerTitle, safePrice);
                addTestResult('üéÅ Special offer added successfully', 'success');
            } catch (error) {
                addTestResult(`‚ùå Error adding special offer: ${error.message}`, 'error');
            }
        }
        
        function updateDisplay() {
            // Update cart status
            const cartStatus = document.getElementById('cart-status');
            cartStatus.innerHTML = `
                <strong>Cart Items:</strong> ${cart.length}<br>
                <strong>Cart Total:</strong> PKR ${getCartTotal().toFixed(2)}<br>
                <strong>Cart Array:</strong> ${JSON.stringify(cart, null, 2)}
            `;
            
            // Update debug info
            const debugInfo = document.getElementById('debug-info');
            debugInfo.innerHTML = `
                <strong>Cart Type:</strong> ${typeof cart}<br>
                <strong>Is Array:</strong> ${Array.isArray(cart)}<br>
                <strong>Cart Length:</strong> ${cart.length}<br>
                <strong>Total Type:</strong> ${typeof getCartTotal()}<br>
                <strong>Total Value:</strong> ${getCartTotal()}<br>
                <strong>Is NaN:</strong> ${isNaN(getCartTotal())}
            `;
        }
        
        function addTestResult(message, type) {
            const results = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = type;
            resultDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            results.appendChild(resultDiv);
            
            // Keep only last 10 results
            const allResults = results.querySelectorAll('div');
            if (allResults.length > 10) {
                allResults[0].remove();
            }
        }
        
        function testAddToCart() {
            addToCart(1, 'Test Pizza', 500);
        }
        
        function testGetCartTotal() {
            const total = getCartTotal();
            addTestResult(`üí∞ Cart total: PKR ${total.toFixed(2)}`, 'success');
        }
        
        function testClearCart() {
            clearCart();
        }
        
        function testSpecialOffer() {
            addSpecialOfferToCart(4, 'Test Special Offer', 300);
        }
        
        // Initialize display
        updateDisplay();
    </script>
</body>
</html> 