<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Counting Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        button { margin: 5px; padding: 8px 15px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Cart Counting Test</h1>
    
    <div class="test-section">
        <h3>Test Cart Operations</h3>
        <button onclick="testAddItems()">Add Test Items</button>
        <button onclick="testClearCart()">Clear Cart</button>
        <button onclick="testUpdateQuantity()">Update Quantity</button>
        <button onclick="testRemoveItem()">Remove Item</button>
        <div id="test-results" class="result"></div>
    </div>

    <div class="test-section">
        <h3>Current Cart State</h3>
        <div id="cart-display"></div>
    </div>

    <script>
        // Initialize global cart
        window.cart = [];
        
        // Test functions
        function testAddItems() {
            // Add some test items
            addToCart('1', 'Pizza Margherita', 12.99, 2);
            addToCart('2', 'Coke', 2.50, 1);
            addToCart('3', 'Garlic Bread', 4.99, 3);
            updateDisplay();
        }
        
        function testClearCart() {
            clearCart();
            updateDisplay();
        }
        
        function testUpdateQuantity() {
            if (window.cart.length > 0) {
                updateItemQuantity(window.cart[0].id, 5);
                updateDisplay();
            }
        }
        
        function testRemoveItem() {
            if (window.cart.length > 0) {
                removeFromCart(window.cart[0].id);
                updateDisplay();
            }
        }
        
        function updateDisplay() {
            const results = document.getElementById('test-results');
            const display = document.getElementById('cart-display');
            
            const totalQuantity = getCartTotalQuantity();
            const uniqueItems = window.cart.length;
            const totalPrice = getCartTotal();
            
            results.innerHTML = `
                <strong>Results:</strong><br>
                Total Quantity: ${totalQuantity}<br>
                Unique Items: ${uniqueItems}<br>
                Total Price: $${totalPrice.toFixed(2)}<br>
                Cart Array Length: ${window.cart.length}
            `;
            
            display.innerHTML = `
                <strong>Cart Contents:</strong><br>
                ${window.cart.map(item => 
                    `${item.name} - Qty: ${item.quantity} - Price: $${item.price} - Total: $${item.totalPrice}`
                ).join('<br>')}
            `;
        }
        
        // Cart functions (simplified versions)
        function addToCart(itemId, itemName, price, quantity = 1) {
            const safePrice = parseFloat(price) || 0;
            const safeQuantity = parseInt(quantity) || 1;
            const stringItemId = String(itemId);
            
            const existingItem = window.cart.find(item => String(item.id) === stringItemId);
            
            if (existingItem) {
                existingItem.quantity += safeQuantity;
                existingItem.totalPrice = existingItem.quantity * existingItem.price;
            } else {
                const newItem = {
                    id: itemId,
                    name: itemName,
                    price: safePrice,
                    quantity: safeQuantity,
                    totalPrice: safePrice * safeQuantity
                };
                window.cart.push(newItem);
            }
        }
        
        function removeFromCart(itemId) {
            const stringItemId = String(itemId);
            window.cart = window.cart.filter(item => String(item.id) !== stringItemId);
        }
        
        function updateItemQuantity(itemId, newQuantity) {
            const stringItemId = String(itemId);
            const item = window.cart.find(item => String(item.id) === stringItemId);
            if (item) {
                const safeQuantity = Math.max(1, parseInt(newQuantity) || 1);
                item.quantity = safeQuantity;
                item.totalPrice = item.quantity * item.price;
            }
        }
        
        function clearCart() {
            window.cart = [];
        }
        
        function getCartTotalQuantity() {
            if (!window.cart || !Array.isArray(window.cart)) {
                return 0;
            }
            return window.cart.reduce((total, item) => {
                return total + (parseInt(item.quantity) || 0);
            }, 0);
        }
        
        function getCartTotal() {
            if (!Array.isArray(window.cart)) {
                return 0;
            }
            const total = window.cart.reduce((total, item) => {
                const itemPrice = parseFloat(item.totalPrice) || 0;
                return total + itemPrice;
            }, 0);
            return parseFloat(total) || 0;
        }
        
        // Initialize display
        updateDisplay();
    </script>
</body>
</html> 